
@{
    ViewBag.Title = "Create";
}

@using WebMatrix.Data
@{
                var db = Database.Open("BoardGame");
                var insertItem = "insert into BoardGame(Name, Description, GameWeight, MinPlayers, MaxPlayers, LanguageEase, NumOwned, NumWish, BestPlayers, Family, ImagePath) values (@0,@1,@2,@3,@4); select scope_identity()";
                var Name = Request.Form["Name"];
                var Description = Request.Form["Description"];
                var Weight = Request.Form["weight"];
                var Image_URL = Request.Form["image_URL"];
                var Category = Request.Form["category"];
                var min_player = Request.Form["min_player"];
                var max_player = Request.Form["max_player"];

                var category_query = "Select C.CategoryID, C.Category from Category as C";
                var allCategory = db.Query(category_query).ToList();

                var family_query = "Select * from GameFamily";
                var allFamily = db.Query(family_query).ToList();

                var theme_query = "Select * from Theme";
                var allTheme = db.Query(theme_query).ToList();

                if (IsPost)
                {
                    try
                    {
                        var inserted_item = db.QueryValue(insertItem, Name, Description, Weight, min_player, max_player, Image_URL, Category);
                <div class="alert alert-success text-center" role="alert">
                    Insert success
                </div>
        Response.Redirect("/Edit?id=" + inserted_item);
        }
        catch
        {
            <div class="alert alert-danger text-center" role="alert">
                Cannot insert item. Please try again.
            </div>
        }
     }
}

<h2 class="text-center bg-secondary m-2">Create Product</h2>
<form action="/Create" method="post" class="container">
    <div class="row">
        <p>BGGId # [Auto]</p>
        <p class="mb-0 px-0">Name</p>
        <input type="text" name="name" class="ms-1 mb-2 col-5" placeholder="Board game name..." required>
        <p class="mb-0 px-0">Category</p>
        <select name="category" class="ms-1 mb-2 col-3" required>
            <option value="@null" selected>Select Category...</option>
            @foreach (var category in allCategory)
            {
                <option value="@category.categoryID">@(category.Category)</option>
            }
        </select>
        <p class="mb-0 px-0">Family</p>
        <select name="family" class="ms-1 mb-2 col-3">
            <option value="@null" selected>Select Family...</option>
            @foreach (var Family in allFamily)
            {
                <option value="@Family.FamilyCode">@(Family.Family)</option>
            }
        </select>
        <p class="mb-0 px-0">Theme</p>
        <select name="theme" class="ms-1 mb-2 col-3" required>
            <option value="@null" selected onclick="document.getElementByID("new_cate").setAttribute('hidden')">Select Theme...</option>
            @foreach (var theme in allTheme)
            {
                <option value="@theme.ThemeID" onclick="document.getElementByID("new_cate").setAttribute('hidden')">@theme.ThemeName</option>
            }
            <option value="" onclick="document.getElementByID("new_cate").removeAttribute('hidden')">A new theme</option>
        </select>
        <span id="new_cate" hidden><input type="text" name="new_theme" value="" placeholder="Enter the new theme name here"/></span>
        <p class="mb-0 px-0">Game weight</p>
        <input type="number" step="0.01" name="weight" class="ms-1 mb-2 col-2" min="0.00" required>
        <p class="mb-0 px-0">Minimum players</p>
        <input type="number" step="1" name="min_play" class="ms-1 mb-2 col-2" min="1" required>
        <p class="mb-0 px-0">Maximum players</p>
        <input type="number" step="1" name="max_play" class="ms-1 mb-2 col-2" min="2" required>
        <p class="mb-0 px-0">Language ease</p>
        <input type="number" step="1" name="ease" class="ms-1 mb-2 col-2">
        <p class="mb-0 px-0">Number of player owned the game</p>
        <input type="number" step="1" name="owned" class="ms-1 mb-2 col-2">
        <p class="mb-0 px-0">Description</p>
        <textarea name="description" placeholder="Game Description" class="ms-1 mb-2 col-12" style="height:200px"></textarea>
        <p class="mb-0 px-0">Image URL</p>
        <input type="text" name="image_URL" placeholder="Image URL" />
    </div>
    <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-success my-2 me-1">Save</button>
        <button type="reset" class="btn btn-danger my-2">Clear</button>
    </div>
</form>
